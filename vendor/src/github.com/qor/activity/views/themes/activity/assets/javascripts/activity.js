!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,t.isPlainObject(o)&&o),this.init()}var e=(window.FormData,window.Mustache),o="qor.activity",a="enable."+o,n="disable."+o,r="click."+o,s="submit."+o,d=".qor-activity__edit-button",l=".qor-tab__activity",c=".qor-activity__edit-note_form",_=".qor-activity__new-note_form",u=".qor-activity__lists";return i.prototype={constructor:i,init:function(){this.$element;this.bind(),this.initTabs()},bind:function(){this.$element.on(r,t.proxy(this.click,this)).on(s,"form",t.proxy(this.submit,this)),t(document).on(r,l,t.proxy(this.tabClick,this))},submit:function(i){var e,o=(i.target,t(i.target)),a=this,n=t("#scroll-tab-activity").data().noteTitle;return i.preventDefault(),e=o.serialize(),t.ajax(o.prop("action"),{method:o.prop("method"),data:e,dataType:"json"}).done(function(i){i.errors||(i.NoteTitle=n,o.is(c)&&(a.hideEditForm(o),o.find(".qor-activity__list-note").html(i.Note)),o.is(_)&&(t(u).prepend(a.renderActivityList(i)),a.clearForm()))}),!1},renderActivityList:function(t){return e.render(i.ACTIVITY_LIST_TEMPLATE,t)},clearForm:function(){t('textarea[data-toggle="qor.redactor"]').redactor("code.set",""),t(_).find('[name="QorResource.Content"],[name="QorResource.Note"]').val("")},click:function(i){var e=t(i.target);if(i.stopPropagation(),e.is(d)){var o=e.closest(".qor-activity__list");this.showEditForm(o)}},tabClick:function(i){var e=this,o=t(u).find(".qor-activity__list").size(),a=t("#scroll-tab-activity").data().noteTitle;if(!o){var n=t(l).data("actionId"),r="/admin/orders/"+n+"/!qor_activities";o?t(u).find(".mdl-spinner").remove():t.ajax({url:r,method:"GET",dataType:"json",success:function(i){if(i.length){t(u).html("");for(var o=i.length-1;o>=0;o--)i[o].NoteTitle=a,t(u).append(e.renderActivityList(i[o]))}t(u).find(".mdl-spinner").remove()}})}},showEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("show").addClass("hide"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("hide").addClass("show")},hideEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("hide").addClass("show"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("show").addClass("hide")},initTabs:function(){t(".qor-slideout.is-shown").get(0)||(t(".qor-page__body").append(i.CONTENT_HTML),t(".qor-form-container").appendTo(t("#scroll-tab-form")),t("#scroll-tab-activity").appendTo(".mdl-layout__content"),t(".qor-page__header .qor-tab-bar--activity-header").prependTo(".mdl-layout.qor-sliderout__activity-container"),t(".qor-page > .qor-page__header").hide(),t(".qor-page > .qor-page__header .qor-action-forms").prependTo("#scroll-tab-form"),t(".qor-layout .mdl-layout__content.has-header").removeClass("has-header"),t("#scroll-tab-activity").wrapInner('<div class="qor-form-container"></div>'))}},i.CONTENT_HTML='<div class="mdl-layout mdl-js-layout qor-sliderout__activity-container"><main class="mdl-layout__content qor-slideout--activity-content"><div class="mdl-layout__tab-panel is-active" id="scroll-tab-form"></div></main></div>',i.DEFAULTS={},i.ACTIVITY_LIST_TEMPLATE='<div class="qor-activity__list"><form class="qor-activity__edit-note_form" action=[[ URL ]] method="POST"><input type="hidden" name="QorResource.ID" value=[[ ID ]]><div class="qor-activity__list-title"><strong>[[ CreatorName ]]</strong> <span>[[ Action ]]</span></div><div class="qor-activity__list-date">[[ UpdatedAt ]]</div><div class="qor-activity__list-content">[[ &Content ]]</div><div><strong>[[ NoteTitle ]]</strong><span class="qor-activity__list-note">[[ Note ]]</span><a class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-button" href="#"><i class="material-icons md-18 qor-activity__edit-button">edit</i></a><div class="mdl-textfield mdl-js-textfield qor-activity__edit-feilds"><label class="mdl-textfield__label">[[ Note ]]</label><input class="mdl-textfield__input" type="text" name="QorResource.Note" value="[[ Note ]]"></div><button class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-save-button" type="submit"><i class="material-icons md-24">done</i></button></div></form></div>',i.plugin=function(e){return this.each(function(){var a,n=t(this),r=n.data(o);if(!r){if(/destroy/.test(e))return;n.data(o,r=new i(this,e))}"string"==typeof e&&t.isFunction(a=r[e])&&a.apply(r)})},t.fn.qorSliderAfterShow.qorActivityinit=function(e,o){var a=t(".qor-slideout > .qor-slideout__body"),n=t(".qor-slideout .qor-tab-bar--activity-header");a.wrapInner(i.CONTENT_HTML),t(".qor-sliderout__activity-container").prepend(n),t(".qor-slideout--activity-content").append(t(".qor-slideout #scroll-tab-activity"))},t(function(){var e='[data-toggle="qor.activity"]';t(document).on(n,function(o){i.plugin.call(t(e,o.target),"destroy")}).on(a,function(o){i.plugin.call(t(e,o.target))}).triggerHandler(a)}),i});