!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):r("object"==typeof exports?require("jquery"):jQuery)}(function(r){"use strict";function e(o,t){this.$element=r(o),this.options=r.extend({},e.DEFAULTS,r.isPlainObject(t)&&t),this.init()}var o="qor.worker",t="enable."+o,s="disable."+o,n="click."+o,i=".qor-worker--new",d=".qor-worker--show-errors";return e.prototype={constructor:e,init:function(){this.$element;this.bind()},bind:function(){this.$element.on(n,r.proxy(this.click,this))},click:function(o){var t=r(o.target);if(o.stopPropagation(),t.is(d)){var s=r(e.POPOVERTEMPLATE).appendTo("body"),n=r("tr.is-selected .qor-button--edit").attr("href");s.qorModal("show"),r.ajax({url:n}).done(function(e){var o=r(e).find(".qor-form-container"),t=o.find(".workers-error-output");t&&t.appendTo(s.find("#qor-worker-errors"))})}if(t.is(i)){var a=t.parent();a.addClass("current"),r(".qor-worker-form-list").not("current").find("form").addClass("hidden"),t.next("form").toggleClass("hidden")}}},e.DEFAULTS={},e.POPOVERTEMPLATE='<div class="qor-modal fade qor-modal--worker-errors" tabindex="-1" role="dialog" aria-hidden="true"><div class="mdl-card mdl-shadow--2dp" role="document"><div class="mdl-card__title"><h2 class="mdl-card__title-text">Process Errors</h2></div><div class="mdl-card__supporting-text" id="qor-worker-errors"></div><div class="mdl-card__actions"><a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" data-dismiss="modal">close</a></div></div></div>',e.plugin=function(t){return this.each(function(){var s,n=r(this),i=n.data(o);if(!i){if(/destroy/.test(t))return;n.data(o,i=new e(this,t))}"string"==typeof t&&r.isFunction(s=i[t])&&s.apply(i)})},r.fn.qorSliderAfterShow.qorWorkInit=function(r,o){e.getWorkerProgressIntervId=window.setInterval(e.getWorkerProgress,1e3,r,o)},e.isScrollToBottom=function(r){return r.clientHeight+r.scrollTop===r.scrollHeight},e.getWorkerProgress=function(o,t){var s=o,n=r(".workers-log-output"),i=r(".qor-worker--progress-value"),d=r(".qor-worker--progress-status"),a=document.querySelector("#qor-worker--progress");return 100==r(".qor-worker--progress").data("worker-progress")?(window.clearInterval(e.getWorkerProgressIntervId),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(100),r(".qor-workers-abort").addClass("hidden"),void r(".qor-workers-rerun").removeClass("hidden")):void r.ajax({url:s}).done(function(o){var t=r(o).find(".qor-form-container"),s=t.find(".qor-worker--progress").data("worker-progress"),l=t.find(".qor-worker--progress").data("worker-status");if(!s)return void window.clearInterval(e.getWorkerProgressIntervId);i.html(s),d.html(l),a&&a.MaterialProgress&&a.MaterialProgress.setProgress(s);var c,u=r.trim(n.html()),f=r.trim(t.find(".workers-log-output").html());f!=u&&(c=f.replace(u,""),e.isScrollToBottom(n[0])?n.append(c).scrollTop(n[0].scrollHeight):n.append(c)),s>=100&&(window.clearInterval(e.getWorkerProgressIntervId),r(".qor-workers-abort").addClass("hidden"),r(".qor-workers-rerun").removeClass("hidden"))})},r(function(){var o='[data-toggle="qor.workers"]';r(document).on(s,function(t){e.plugin.call(r(o,t.target),"destroy")}).on(t,function(t){e.plugin.call(r(o,t.target))}).triggerHandler(t)}),e});